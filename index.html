<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Anthony Ionno" />

<meta name="date" content="2018-04-28" />

<title>Revisiting Toronto Transit Commission Delay Data</title>

<script src="index_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="index_files/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="index_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="index_files/navigation-1.1/tabsets.js"></script>
<script src="index_files/navigation-1.1/codefolding.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; }
td.sourceCode { padding-left: 5px; }
code > span.kw { font-weight: bold; } /* Keyword */
code > span.dt { text-decoration: underline; } /* DataType */
code > span.co { font-style: italic; } /* Comment */
code > span.al { font-weight: bold; } /* Alert */
code > span.er { font-weight: bold; } /* Error */
code > span.wa { font-style: italic; } /* Warning */
code > span.cf { font-weight: bold; } /* ControlFlow */
code > span.pp { font-weight: bold; } /* Preprocessor */
code > span.do { font-style: italic; } /* Documentation */
code > span.an { font-style: italic; } /* Annotation */
code > span.cv { font-style: italic; } /* CommentVar */
code > span.in { font-style: italic; } /* Information */
div.sourceCode {
  overflow-x: visible;
}
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>






<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Revisiting Toronto Transit Commission Delay Data</h1>
<h4 class="author"><em>Anthony Ionno</em></h4>
<h4 class="date"><em>April 28, 2018</em></h4>

</div>

<div id="TOC">
<ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#analysis">Analysis</a><ul>
<li><a href="#data">Data</a></li>
<li><a href="#r-libraries">R libraries</a></li>
<li><a href="#preprocessing">Preprocessing</a></li>
<li><a href="#results">Results</a><ul>
<li><a href="#bus-delays">Bus Delays</a></li>
<li><a href="#streetcar-delays">Streetcar Delays</a></li>
<li><a href="#subway-delays">Subway Delays</a></li>
</ul></li>
</ul></li>
<li><a href="#system-information">System Information</a></li>
</ul>
</div>

<div id="summary" class="section level2">
<h2>Summary</h2>
<p>This post analyses Toronto Transit Commission (TTC) bus, streetcar, and subway delay data to better understand, based on pre-defined incident types, which incidents are occurring most frequently, when are they occurring throughout the day, and for how long typically, this is done through the presentation of a triplet of data visualisations for each transit type.</p>
<p>What this analysis identifies is the following:</p>
<ul>
<li><p>Delays for buses and streetcars are typically due to mechanical issues; a much higher proportion of incidents and therefore delays typically occur around 5:00 am and 2:00 pm; over 93% of delays last about 30 minutes.</p></li>
<li><p>Subways have a larger variety of incident types to choose from but the most frequent incident types that lead to delays are due to issues around speed control and operator over-speeding. Neither the dataset nor the metadata provided identify what is meant by speed control as an incident type. Subway delays more frequently occur around 7:00 am and 4:00 pm. Subway delays are far shorter than either bus or streetcar delays; roughly 98% of subway delays are under 15 minutes.</p></li>
</ul>
</div>
<div id="analysis" class="section level2">
<h2>Analysis</h2>
<p>As mentioned previously this analysis investigates bus, streetcar, and subway delay data through the use of three data visualisations: a bar chart that displays the top incident types for a particular transit type, ranked by percent of total incident occurence; a histogram that displays the percentage of total incident count within a given hour; and a series of empricial probability density functions that display the likelihood that a delay is between a particular range of duration times.</p>
<div id="data" class="section level3">
<h3>Data</h3>
<p>The raw data used to conduct this analysis can be located on the City of Torontoâ€™s open data website and contains bus, streetcar, and subway delay information anywhere from 2014 through 2017.</p>
<p>For any of the three datasets, each row pertains to a particular delay and contains the following information:</p>
<ul>
<li>Report date</li>
<li>Trip route</li>
<li>Time of day</li>
<li>Day of week</li>
<li>General location</li>
<li>Incident type (reason for delay)</li>
<li>The minimum delay</li>
<li>The minimum gap</li>
<li>The direction the vehicle was travelling</li>
<li>Vehicle number</li>
</ul>
<p>More information on these datasets can be located at the following links: <a href="https://www.toronto.ca/city-government/data-research-maps/open-data/open-data-catalogue/#bb967f18-8d90-defc-2946-db3543648bd6">TTC Bus Delay Data</a>, <a href="https://www.toronto.ca/city-government/data-research-maps/open-data/open-data-catalogue/#e8f359f0-2f47-3058-bf64-6ec488de52da">TTC Streetcar Delay Data</a>, and <a href="https://www.toronto.ca/city-government/data-research-maps/open-data/open-data-catalogue/#917dd033-1fe5-4ba8-04ca-f683eec89761">TTC Subway Delay Data</a>.</p>
</div>
<div id="r-libraries" class="section level3">
<h3>R libraries</h3>
<p>The following R libraries were loaded for this analysis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr);<span class="kw">library</span>(magrittr);<span class="kw">library</span>(ggplot2);<span class="kw">library</span>(readxl);
<span class="kw">library</span>(readr);<span class="kw">library</span>(extrafont);<span class="kw">library</span>(stringr)</code></pre></div>
</div>
<div id="preprocessing" class="section level3">
<h3>Preprocessing</h3>
<p>The code below highlights how the bus, streetcar, and subway delay datasets were read and transmuted within the R environment.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># File directory and list</span>
file.directory&lt;-<span class="st">&quot;Data/&quot;</span>
file.list&lt;-<span class="kw">list.files</span>(<span class="st">&quot;Data/&quot;</span>)

<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">12</span>){
  <span class="cf">if</span>(i<span class="op">==</span><span class="dv">1</span>){
bus.<span class="dv">2014</span>&lt;-<span class="kw">read_xlsx</span>(<span class="kw">paste</span>(file.directory,file.list[<span class="dv">1</span>],<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="dt">sheet=</span>i)
bus.<span class="dv">2015</span>&lt;-<span class="kw">read_xlsx</span>(<span class="kw">paste</span>(file.directory,file.list[<span class="dv">2</span>],<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="dt">sheet=</span>i)
bus.<span class="dv">2016</span>&lt;-<span class="kw">read_xlsx</span>(<span class="kw">paste</span>(file.directory,file.list[<span class="dv">3</span>],<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="dt">sheet=</span>i)
streetcar.<span class="dv">2015</span>&lt;-<span class="kw">read_xlsx</span>(<span class="kw">paste</span>(file.directory,file.list[<span class="dv">5</span>],<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="dt">sheet=</span>i)
streetcar.<span class="dv">2016</span>&lt;-<span class="kw">read_xlsx</span>(<span class="kw">paste</span>(file.directory,file.list[<span class="dv">6</span>],<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="dt">sheet=</span>i)
  }
  <span class="cf">if</span>(i<span class="op">!=</span><span class="dv">1</span>){
    temp.<span class="dv">1</span>&lt;-<span class="kw">read_xlsx</span>(<span class="kw">paste</span>(file.directory,file.list[<span class="dv">1</span>],<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="dt">sheet=</span>i)
    bus.<span class="dv">2014</span>&lt;-<span class="kw">rbind</span>(bus.<span class="dv">2014</span>,temp.<span class="dv">1</span>)
    temp.<span class="dv">2</span>&lt;-<span class="kw">read_xlsx</span>(<span class="kw">paste</span>(file.directory,file.list[<span class="dv">2</span>],<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="dt">sheet=</span>i)
    bus.<span class="dv">2015</span>&lt;-<span class="kw">rbind</span>(bus.<span class="dv">2015</span>,temp.<span class="dv">2</span>)
    temp.<span class="dv">3</span>&lt;-<span class="kw">read_xlsx</span>(<span class="kw">paste</span>(file.directory,file.list[<span class="dv">3</span>],<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="dt">sheet=</span>i)
    bus.<span class="dv">2016</span>&lt;-<span class="kw">rbind</span>(bus.<span class="dv">2016</span>,temp.<span class="dv">3</span>)
    temp.<span class="dv">4</span>&lt;-<span class="kw">read_xlsx</span>(<span class="kw">paste</span>(file.directory,file.list[<span class="dv">5</span>],<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="dt">sheet=</span>i)
    streetcar.<span class="dv">2015</span>&lt;-<span class="kw">rbind</span>(streetcar.<span class="dv">2015</span>,temp.<span class="dv">4</span>)
    temp.<span class="dv">5</span>&lt;-<span class="kw">read_xlsx</span>(<span class="kw">paste</span>(file.directory,file.list[<span class="dv">6</span>],<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="dt">sheet=</span>i)
    streetcar.<span class="dv">2016</span>&lt;-<span class="kw">rbind</span>(streetcar.<span class="dv">2016</span>,temp.<span class="dv">5</span>)
  
  }
}

<span class="co"># Merging bus and streetcar data</span>
bus.df&lt;-<span class="kw">rbind</span>(bus.<span class="dv">2014</span>,bus.<span class="dv">2015</span>,bus.<span class="dv">2016</span>)
streetcar.df&lt;-<span class="kw">rbind</span>(streetcar.<span class="dv">2015</span>,streetcar.<span class="dv">2016</span>)

<span class="co"># Reading in subway data and creating new variables </span>
 subway.df&lt;-<span class="kw">read_xlsx</span>(<span class="kw">paste</span>(file.directory,file.list[<span class="dv">9</span>],<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="dt">sheet=</span><span class="dv">2</span>)
    subway.codes&lt;-<span class="kw">read_xlsx</span>(<span class="kw">paste</span>(file.directory,file.list[<span class="dv">8</span>],<span class="dt">sep=</span><span class="st">&quot;&quot;</span>),<span class="dt">sheet=</span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">select</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>)
    <span class="kw">names</span>(subway.codes)[<span class="dv">1</span>]&lt;-<span class="st">&quot;Code&quot;</span>
    <span class="kw">names</span>(subway.codes)[<span class="dv">2</span>]&lt;-<span class="st">&quot;Code_name&quot;</span>
    subway.df&lt;-<span class="kw">left_join</span>(subway.df,subway.codes)
    subway.df&lt;-subway.df[<span class="kw">complete.cases</span>(subway.df),]
    subway.df&lt;-subway.df <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">mutate</span>(<span class="dt">Year=</span><span class="kw">format</span>(Date,<span class="st">&quot;%Y&quot;</span>))
    
    
<span class="co"># Custom ggplot theme</span>
theme_ai &lt;-<span class="st"> </span><span class="cf">function</span>(){
  <span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(
      <span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Segoe UI&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;gray25&quot;</span>),
      <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">16</span>),
      <span class="dt">plot.subtitle =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">14</span>),
      <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">13</span>),
      <span class="dt">axis.title.x =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">15</span>),
      <span class="dt">axis.title.y =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">15</span>),
      <span class="dt">legend.title =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">15</span>),
      <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">15</span>),
      <span class="dt">plot.caption =</span> <span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&quot;gray30&quot;</span>, <span class="dt">size=</span><span class="dv">12</span>),
      <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;gray95&quot;</span>),
      <span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">10</span>), <span class="dt">units =</span> <span class="st">&quot;mm&quot;</span>),
      <span class="co">#axis.line = element_line(color=&quot;gray50&quot;)</span>
      <span class="dt">axis.ticks.x =</span> <span class="kw">element_line</span>(<span class="dt">color=</span><span class="st">&quot;gray35&quot;</span>),
      <span class="dt">panel.grid.major.y =</span> <span class="kw">element_line</span>(<span class="dt">colour =</span> <span class="st">&quot;gray80&quot;</span>))
  
}</code></pre></div>
</div>
<div id="results" class="section level3">
<h3>Results</h3>
<div id="bus-delays" class="section level4">
<h4>Bus Delays</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">########################
<span class="co"># Column plot of incident</span>
<span class="co"># count</span>
########################
bus.df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Incident) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">tally</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">reorder</span>(Incident,n),<span class="dt">y=</span><span class="kw">I</span>((n<span class="op">/</span><span class="kw">sum</span>(n)))<span class="op">*</span><span class="dv">100</span>),<span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>,<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>,<span class="dt">fill=</span><span class="st">&quot;gray45&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">reorder</span>(Incident,n),<span class="dt">y=</span><span class="kw">I</span>((n<span class="op">/</span><span class="kw">sum</span>(n))<span class="op">*</span><span class="dv">100</span>),<span class="dt">label=</span><span class="kw">round</span>((n<span class="op">/</span><span class="kw">sum</span>(n))<span class="op">*</span><span class="dv">100</span>,<span class="dv">1</span>),<span class="dt">hjust=</span><span class="op">+</span><span class="fl">1.2</span>),<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">theme_ai</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Over half of reported bus incidents are due to</span><span class="ch">\n</span><span class="st">mechanical failures&quot;</span>,
       <span class="dt">subtitle=</span><span class="st">&quot;TTC transit data for 2014 through 2016&quot;</span>,
       <span class="dt">x=</span><span class="st">&quot;&quot;</span>,
       <span class="dt">y=</span><span class="st">&quot;Percent of Total&quot;</span>,
       <span class="dt">caption=</span><span class="st">&quot;Data Source: City of Toronto | Creation: Anthony Ionno&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">10</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" width="1152" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">#######################
<span class="co"># Column plot of incidents</span>
<span class="co"># broken down by Hour and Minute</span>
#######################
bus.df <span class="op">%&gt;%</span>
<span class="st">   </span><span class="kw">mutate</span>(<span class="dt">Hour_minute=</span><span class="kw">format</span>(Time,<span class="st">&quot;%H&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Hour_minute) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Hour_minute) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">tally</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Hour_minute,<span class="dt">y=</span><span class="kw">I</span>(n<span class="op">/</span><span class="kw">sum</span>(n)<span class="op">*</span><span class="dv">100</span>)),<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>,<span class="dt">fill=</span><span class="st">&quot;gray45&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">theme_ai</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Incidents are reported most frequently around</span><span class="ch">\n</span><span class="st">5:00 am and 2:00 pm&quot;</span>,
       <span class="dt">subtitle=</span><span class="st">&quot;TTC transit data for 2014 through 2016&quot;</span>,
       <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>,
       <span class="dt">y=</span><span class="st">&quot;Percent of Total&quot;</span>,
       <span class="dt">caption=</span><span class="st">&quot;Data Source: City of Toronto | Creation: Anthony Ionno&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">5</span>))</code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" width="1152" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Density plot of delay times</span>
bus.df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Year=</span><span class="kw">format</span>(<span class="st">`</span><span class="dt">Report Date</span><span class="st">`</span>,<span class="st">&quot;%Y&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="st">`</span><span class="dt">Min Delay</span><span class="st">`</span><span class="op">&lt;</span><span class="dv">60</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="st">`</span><span class="dt">Min Delay</span><span class="st">`</span>,<span class="dt">fill=</span>Year),<span class="dt">alpha=</span>.<span class="dv">3</span>,<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">theme_ai</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>,
         <span class="dt">legend.title =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">13</span>),
        <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">13</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;98% of delays are under one hour;</span><span class="ch">\n</span><span class="st">93% are under 30 minutes;</span><span class="ch">\n</span><span class="st">71% are under 15 minutes.&quot;</span>,
       <span class="dt">subtitle=</span><span class="st">&quot;TTC transit data for 2014 through 2016&quot;</span>,
       <span class="dt">x=</span><span class="st">&quot;Schedule Delay in Minutes&quot;</span>,
       <span class="dt">y=</span><span class="st">&quot;Percent of Total&quot;</span>,
       <span class="dt">caption=</span><span class="st">&quot;Data Source: City of Toronto | Creation: Anthony Ionno&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,.<span class="dv">05</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">5</span>),<span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">60</span>))</code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" width="1152" /></p>
</div>
<div id="streetcar-delays" class="section level4">
<h4>Streetcar Delays</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">streetcar.df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Incident) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">tally</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">reorder</span>(Incident,n),<span class="dt">y=</span><span class="kw">I</span>((n<span class="op">/</span><span class="kw">sum</span>(n)))<span class="op">*</span><span class="dv">100</span>),<span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>,<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>,<span class="dt">fill=</span><span class="st">&quot;gray45&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">reorder</span>(Incident,n),<span class="dt">y=</span><span class="kw">I</span>((n<span class="op">/</span><span class="kw">sum</span>(n))<span class="op">*</span><span class="dv">100</span>),<span class="dt">label=</span><span class="kw">round</span>((n<span class="op">/</span><span class="kw">sum</span>(n))<span class="op">*</span><span class="dv">100</span>,<span class="dv">1</span>),<span class="dt">hjust=</span><span class="op">+</span><span class="fl">1.2</span>),<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">theme_ai</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Over half of reported streetcar incidents are due to</span><span class="ch">\n</span><span class="st">mechanical failures&quot;</span>,
       <span class="dt">subtitle=</span><span class="st">&quot;TTC transit data for 2015 through 2016&quot;</span>,
       <span class="dt">x=</span><span class="st">&quot;&quot;</span>,
       <span class="dt">y=</span><span class="st">&quot;Percent of Total&quot;</span>,
       <span class="dt">caption=</span><span class="st">&quot;Data Source: City of Toronto | Creation: Anthony Ionno&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">10</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-6-1.png" width="1152" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">streetcar.df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Hour_minute=</span><span class="kw">format</span>(Time,<span class="st">&quot;%H&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Hour_minute) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Hour_minute) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">tally</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Hour_minute,<span class="dt">y=</span><span class="kw">I</span>(n<span class="op">/</span><span class="kw">sum</span>(n)<span class="op">*</span><span class="dv">100</span>)),<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>,<span class="dt">fill=</span><span class="st">&quot;gray45&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">theme_ai</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Incidents are reported most frequently around</span><span class="ch">\n</span><span class="st">5:00 am and 2:00 pm&quot;</span>,
       <span class="dt">subtitle=</span><span class="st">&quot;TTC transit data for 2015 through 2016&quot;</span>,
       <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>,
       <span class="dt">y=</span><span class="st">&quot;Percent of Total&quot;</span>,
       <span class="dt">caption=</span><span class="st">&quot;Data Source: City of Toronto | Creation: Anthony Ionno&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">5</span>))</code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" width="1152" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">streetcar.df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Year=</span><span class="kw">format</span>(<span class="st">`</span><span class="dt">Report Date</span><span class="st">`</span>,<span class="st">&quot;%Y&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="st">`</span><span class="dt">Min Delay</span><span class="st">`</span><span class="op">&lt;</span><span class="dv">60</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="st">`</span><span class="dt">Min Delay</span><span class="st">`</span>,<span class="dt">fill=</span>Year),<span class="dt">alpha=</span>.<span class="dv">3</span>,<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">theme_ai</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>,
        <span class="dt">legend.title =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">13</span>),
        <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">13</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;97.5% of delays are under one hour;</span><span class="ch">\n</span><span class="st">91.5% are under 30 minutes;</span><span class="ch">\n</span><span class="st">78.1% are under 15 minutes.&quot;</span>,
       <span class="dt">subtitle=</span><span class="st">&quot;TTC transit data for 2015 through 2016&quot;</span>,
       <span class="dt">x=</span><span class="st">&quot;Schedule Delay in Minutes&quot;</span>,
       <span class="dt">y=</span><span class="st">&quot;Percent of Total&quot;</span>,
       <span class="dt">caption=</span><span class="st">&quot;Data Source: City of Toronto | Creation: Anthony Ionno&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,.<span class="dv">05</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">5</span>),<span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">60</span>))</code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" width="1152" /></p>
</div>
<div id="subway-delays" class="section level4">
<h4>Subway Delays</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">subway.df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Code_name) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">2014</span><span class="op">:</span><span class="dv">2016</span>))<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">tally</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n=</span>n<span class="op">/</span><span class="kw">sum</span>(n))<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">top_n</span>(<span class="dv">20</span>)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n))<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">reorder</span>(Code_name,n),<span class="dt">y=</span><span class="kw">I</span>(n<span class="op">*</span><span class="dv">100</span>)),<span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>,<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>,<span class="dt">fill=</span><span class="st">&quot;gray45&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="co">#geom_text(aes(x=reorder(Code_name,n),y=I(n*100),label=round(n*100,1),hjust=-0.4),colour=&quot;black&quot;)+</span>
<span class="st">  </span><span class="kw">theme_ai</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Top 20 subway delays: speed control and operator overspeeding</span><span class="ch">\n</span><span class="st">are the most frequent reason for delay&quot;</span>,
       <span class="dt">subtitle=</span><span class="st">&quot;TTC transit data for 2014 through 2016&quot;</span>,
       <span class="dt">x=</span><span class="st">&quot;&quot;</span>,
       <span class="dt">y=</span><span class="st">&quot;Percent of Total&quot;</span>,
       <span class="dt">caption=</span><span class="st">&quot;Data Source: City of Toronto | Creation: Anthony Ionno&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">2</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" width="1152" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">subway.df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Hour_minute=</span><span class="kw">str_split</span>(subway.df<span class="op">$</span>Time,<span class="st">&quot;:&quot;</span>,<span class="dt">simplify =</span> <span class="ot">TRUE</span>)[,<span class="dv">1</span>]) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Hour_minute) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Hour_minute) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">tally</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Hour_minute,<span class="dt">y=</span><span class="kw">I</span>(n<span class="op">/</span><span class="kw">sum</span>(n)<span class="op">*</span><span class="dv">100</span>)),<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>,<span class="dt">fill=</span><span class="st">&quot;gray45&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">theme_ai</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Incidents are reported most frequently around</span><span class="ch">\n</span><span class="st">7:00 am and 4:00 pm&quot;</span>,
       <span class="dt">subtitle=</span><span class="st">&quot;TTC transit data for 2014 through 2016&quot;</span>,
       <span class="dt">x=</span><span class="st">&quot;Hour&quot;</span>,
       <span class="dt">y=</span><span class="st">&quot;Percent of Total&quot;</span>,
       <span class="dt">caption=</span><span class="st">&quot;Data Source: City of Toronto | Creation: Anthony Ionno&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">5</span>))</code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" width="1152" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">subway.df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co">#mutate(Year=format(`Date`,&quot;%Y&quot;)) %&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="st">`</span><span class="dt">Min Delay</span><span class="st">`</span><span class="op">&lt;</span><span class="dv">60</span> <span class="op">&amp;</span><span class="st"> </span>Year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">2014</span><span class="op">:</span><span class="dv">2016</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="st">`</span><span class="dt">Min Delay</span><span class="st">`</span>,<span class="dt">fill=</span>Year),<span class="dt">alpha=</span>.<span class="dv">3</span>,<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">theme_ai</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>,
         <span class="dt">legend.title =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">13</span>),
        <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">13</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;98.1% of delays are under 15 minutes;</span><span class="ch">\n</span><span class="st">95.8% are under 10 minutes;</span><span class="ch">\n</span><span class="st">85.4% are under 5 minutes.&quot;</span>,
       <span class="dt">subtitle=</span><span class="st">&quot;TTC transit data for 2014 through 2016&quot;</span>,
       <span class="dt">x=</span><span class="st">&quot;Schedule Delay in Minutes&quot;</span>,
       <span class="dt">y=</span><span class="st">&quot;Percent of Total&quot;</span>,
       <span class="dt">caption=</span><span class="st">&quot;Data Source: City of Toronto | Creation: Anthony Ionno&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,.<span class="dv">25</span>))<span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">1</span>),<span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">15</span>))</code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" width="1152" /></p>
</div>
</div>
</div>
<div id="system-information" class="section level2">
<h2>System Information</h2>
<pre><code>## R version 3.4.1 (2017-06-30)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 7 x64 (build 7601) Service Pack 1
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=English_United States.1252 
## [2] LC_CTYPE=English_United States.1252   
## [3] LC_MONETARY=English_United States.1252
## [4] LC_NUMERIC=C                          
## [5] LC_TIME=English_United States.1252    
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] RevoUtilsMath_10.0.0 RevoUtils_10.0.5     RevoMods_11.0.0     
## [4] MicrosoftML_1.5.0    mrsdeploy_1.1.2      RevoScaleR_9.2.1    
## [7] lattice_0.20-35      rpart_4.1-11        
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_0.12.12           codetools_0.2-15       CompatibilityAPI_1.1.0
##  [4] rprojroot_1.2          digest_0.6.12          foreach_1.4.4         
##  [7] grid_3.4.1             R6_2.2.0               backports_1.1.0       
## [10] jsonlite_1.4           magrittr_1.5           evaluate_0.10.1       
## [13] stringi_1.1.5          curl_2.6               rmarkdown_1.6         
## [16] iterators_1.0.8        tools_3.4.1            stringr_1.2.0         
## [19] yaml_2.1.14            compiler_3.4.1         htmltools_0.3.6       
## [22] knitr_1.17</code></pre>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
